<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Order Management - Fresh Footwear</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <span class="navbar-brand">Fresh Footwear Admin</span>
      <div class="d-flex">
        <span class="text-white me-3">Welcome, {{ admin_name }}</span>
        <a href="/admin/dashboard" class="btn btn-outline-light btn-sm me-2">Dashboard</a>
        <a href="/admin/logout" class="btn btn-outline-light btn-sm">Logout</a>
      </div>
    </div>
  </nav>

  <div class="container mt-5">
    <h3 class="mb-4">Order Management</h3>

    <div class="mb-3">
      <a href="/admin/orders" class="btn btn-outline-dark btn-sm {% if not request.args.get('status') %}active{% endif %}">All</a>
      {% for status in ['Pending','Paid','Processing','Shipped','Delivered','Cancelled','Returned'] %}
        <a href="/admin/orders?status={{ status }}" 
          class="btn btn-sm
            {% if request.args.get('status') == status %}
              {% if status == 'Pending' %}btn-warning text-dark{% 
              elif status == 'Paid' %}btn-info text-dark{%
              elif status == 'Processing' %}btn-primary{%
              elif status == 'Shipped' %}btn-secondary{%
              elif status == 'Delivered' %}btn-success{%
              elif status == 'Cancelled' %}btn-danger{%
              elif status == 'Returned' %}btn-dark{%
              else %}btn-outline-dark{% endif %}
              active
            {% else %}
              btn-outline-dark
            {% endif %}">
          {{ status }}
        </a>
      {% endfor %}
    </div>

    <form method="get" class="d-flex mb-4" action="/admin/orders">
      {% if request.args.get('status') %}
        <input type="hidden" name="status" value="{{ request.args.get('status') }}">
      {% endif %}
      <input type="text" class="form-control me-2" name="q" placeholder="Search by username or order ID" 
          value="{{ request.args.get('q') or '' }}">
      <button class="btn btn-outline-primary" type="submit">Search</button>
    </form>

    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Status</th>
          <th>Total ($)</th>
          <th>Shipment</th>
          <th>Tracking #</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for o in orders %}
        <tr>
          <td>{{ o.order_id }}</td>
          <td>{{ o.username }}</td>
          <td>{{ o.order_date.strftime('%Y-%m-%d') if o.order_date else '' }}</td>
          <td>
            {% if o.order_status == 'Pending' %}
              <span class="badge bg-warning text-dark">Pending</span>
            {% elif o.order_status == 'Paid' %}
              <span class="badge bg-info text-dark">Paid</span>
            {% elif o.order_status == 'Processing' %}
              <span class="badge bg-primary">Processing</span>
            {% elif o.order_status == 'Shipped' %}
              <span class="badge bg-secondary">Shipped</span>
            {% elif o.order_status == 'Delivered' %}
              <span class="badge bg-success">Delivered</span>
            {% elif o.order_status == 'Cancelled' %}
              <span class="badge bg-danger">Cancelled</span>
            {% elif o.order_status == 'Returned' %}
              <span class="badge bg-dark">Returned</span>
            {% else %}
              <span class="badge bg-light text-dark">{{ o.order_status }}</span>
            {% endif %}
          </td>
          <td>${{ '%.2f'|format(o.total_amount) }}</td>
          <td>{{ o.carrier or 'N/A' }}</td>
          <td>{{ o.tracking_number or 'N/A' }}</td>
          <td>
            <a href="/admin/orders/{{ o.order_id }}" class="btn btn-sm btn-primary">View / Edit</a>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="8" class="text-center text-muted">No orders found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
